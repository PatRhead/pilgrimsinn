// Copyright 2012 Designgeneers! Web Design (email: info@designgeneers.com)
// 
function DgxDonateTrim(e){e==undefined&&(e="");e=e.replace(/(^\s*)|(\s*$)/gi,"");e=e.replace(/[ ]{2,}/gi," ");e=e.replace(/\n /,"\n");return e}function DgxDonateLooksLikeMail(e){var t=e.lastIndexOf("@"),n=e.lastIndexOf(".");return t<n&&t>0&&e.indexOf("@@")==-1&&n>2&&e.length-n>2}function DgxDonateCountNeedles(e,t){var n=0,r=-1;r=t.indexOf(e,r+1);while(r!=-1){n++;r=t.indexOf(e,r+1)}return n}function DgxDonateIsValidAmount(e){if(e=="")return!1;var t=e.match(/[^0123456789.]/g);if(t!=null){alert("Please use only numbers when specifying your donation amount.");return!1}var n=DgxDonateCountNeedles(".",e);if(n>1)return!1;if(e.substr(0,1)=="0")return!1;if(e.substr(0,1)==".")return!1;if(n==1){var r=e.indexOf(".");if(r+2!=e.length-1)return!1}return!0}function DgxDonateUpdateControls(e){if("undefined"!=typeof e.donateButton)if(e.donateButton){jQuery(".dgx-donate-pay-enabled").show();jQuery(".dgx-donate-pay-disabled").hide()}else{jQuery(".dgx-donate-pay-enabled").hide();jQuery(".dgx-donate-pay-disabled").show()}"undefined"!=typeof e.ajaxSpinner&&(e.ajaxSpinner?jQuery(".dgx-donate-busy").show():jQuery(".dgx-donate-busy").hide())}function DgxDonateDoCheckout(){DgxDonateUpdateControls({donateButton:!1,ajaxSpinner:!1});jQuery(".dgx-donate-error-msg").html("");jQuery(".dgx-donate-error-msg").css("visibility","hidden");var e=!0;jQuery("#dgx-donate-form").find("input").removeClass("dgx-donate-invalid-input");var t={};jQuery.each(jQuery("#dgx-donate-form").serializeArray(),function(e,n){t[n.name]=n.value});var n=t._dgx_donate_session_id,r=DgxDonateTrim(t._dgx_donate_amount),i=DgxDonateTrim(t._dgx_donate_user_amount),s=DgxDonateTrim(t._dgx_donate_repeating),o=DgxDonateTrim(t._dgx_donate_designated),u=DgxDonateTrim(t._dgx_donate_designated_fund),a=DgxDonateTrim(t._dgx_donate_increase_to_cover),f=DgxDonateTrim(t._dgx_donate_anonymous),l=DgxDonateTrim(t._dgx_donate_tribute_gift),c=DgxDonateTrim(t._dgx_donate_employer_match),h=DgxDonateTrim(t._dgx_donate_employer_name),p=DgxDonateTrim(t._dgx_donate_memorial_gift),d=DgxDonateTrim(t._dgx_donate_honoree_name),v=DgxDonateTrim(t._dgx_donate_honor_by_email),m=DgxDonateTrim(t._dgx_donate_honoree_email_name),g=DgxDonateTrim(t._dgx_donate_honoree_email),y=DgxDonateTrim(t._dgx_donate_honoree_post_name),b=DgxDonateTrim(t._dgx_donate_honoree_address),w=DgxDonateTrim(t._dgx_donate_honoree_city),E=DgxDonateTrim(t._dgx_donate_honoree_state),S=DgxDonateTrim(t._dgx_donate_honoree_province),x=DgxDonateTrim(t._dgx_donate_honoree_country),T=DgxDonateTrim(t._dgx_donate_honoree_zip),N=DgxDonateTrim(t._dgx_donate_donor_first_name),C=DgxDonateTrim(t._dgx_donate_donor_last_name),k=DgxDonateTrim(t._dgx_donate_donor_phone),L=DgxDonateTrim(t._dgx_donate_donor_email),A=DgxDonateTrim(t._dgx_donate_add_to_mailing_list),O=DgxDonateTrim(t._dgx_donate_donor_address),M=DgxDonateTrim(t._dgx_donate_donor_address2),_=DgxDonateTrim(t._dgx_donate_donor_city),D=DgxDonateTrim(t._dgx_donate_donor_state),P=DgxDonateTrim(t._dgx_donate_donor_province),H=DgxDonateTrim(t._dgx_donate_donor_country),B=DgxDonateTrim(t._dgx_donate_donor_zip),a=DgxDonateTrim(t._dgx_donate_increase_to_cover),j=DgxDonateTrim(t._dgx_donate_payment_method),F=DgxDonateTrim(t._dgx_donate_uk_gift_aid),I=location.href,q="";r=="OTHER"?q=i:q=r;if(!DgxDonateIsValidAmount(q)){e=!1;DgxDonateMarkInvalid("_dgx_donate_user_amount")}if(l=="on"){if(d==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_name")}if(v=="TRUE"){if(m==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_email_name")}if(g==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_email")}}else{if(y==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_post_name")}if(b==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_address")}if(w==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_city")}if(T==""&&dgxDonateAjax.postalCodeRequired.indexOf(x)>=0){e=!1;DgxDonateMarkInvalid("_dgx_donate_honoree_zip")}}}if(c=="on"&&h==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_employer_name")}if(N==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_first_name")}if(C==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_last_name")}if(k==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_phone")}if(L==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_email")}if(O==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_address")}if(_==""){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_city")}if(B==""&&dgxDonateAjax.postalCodeRequired.indexOf(H)>=0){e=!1;DgxDonateMarkInvalid("_dgx_donate_donor_zip")}if(!e){alert("Some required information is missing or invalid.  Please complete the fields highlighted in red");DgxDonateUpdateControls({donateButton:!0,ajaxSpinner:!1});return!1}DgxDonateUpdateControls({donateButton:!1,ajaxSpinner:!0});var R=jQuery("#dgx-donate-hidden-form");R.find('input[name="first_name"]').val(N);R.find('input[name="last_name"]').val(C);R.find('input[name="address1"]').val(O);R.find('input[name="address2"]').val(M);R.find('input[name="city"]').val(_);R.find('input[name="state"]').val(D);R.find('input[name="zip"]').val(B);"US"==H?R.find('input[name="state"]').val(D):"CA"==H?R.find('input[name="state"]').val(P):R.find('input[name="state"]').remove();R.find('input[name="country"]').val(H);R.find('input[name="email"]').val(L);R.find('input[name="custom"]').val(n);R.find('input[name="amount"]').val(q);if(!s){R.find('input[name="src"]').remove();R.find('input[name="p3"]').remove();R.find('input[name="t3"]').remove();R.find('input[name="a3"]').remove()}else{R.find('input[name="cmd"]').val("_xclick-subscriptions");R.find('input[name="p3"]').val("1");R.find('input[name="t3"]').val("M");R.find('input[name="a3"]').val(q);R.find('input[name="amount"]').remove()}var U=dgxDonateAjax.nonce,z={action:"dgx_donate_paypalstd_ajax_checkout",referringUrl:I,nonce:U,sessionID:n,donationAmount:r,userAmount:i,repeating:s,designated:o,designatedFund:u,increaseToCover:a,anonymous:f,employerMatch:c,employerName:h,tributeGift:l,honoreeName:d,honorByEmail:v,honoreeEmail:g,memorialGift:p,honoreeEmailName:m,honoreePostName:y,honoreeAddress:b,honoreeCity:w,honoreeState:E,honoreeProvince:S,honoreeCountry:x,honoreeZip:T,firstName:N,lastName:C,phone:k,email:L,addToMailingList:A,address:O,address2:M,city:_,state:D,province:P,country:H,zip:B,increaseToCover:a,paymentMethod:j,ukGiftAid:F};jQuery.post(dgxDonateAjax.ajaxurl,z,DgxDonateCallback);return!1}function DgxDonateCallback(e){jQuery("#dgx-donate-hidden-form").submit()}function DgxDonateMarkInvalid(e){var t="input[name="+e+"]";jQuery("#dgx-donate-form").find(t).addClass("dgx-donate-invalid-input")}function DgxDonateAjaxError(e,t,n,r){DgxDonateUpdateControls({donateButton:!0,ajaxSpinner:!1});alert("An Ajax error occurred while requesting the resource - "+n.url+" - No donation was completed.  Please try again later.");return!1}jQuery(document).ready(function(){DgxDonateUpdateControls({donateButton:!0,ajaxSpinner:!1})});